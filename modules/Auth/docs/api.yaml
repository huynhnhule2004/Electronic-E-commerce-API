openapi: 3.0.0
info:
  title: Auth Module API
  description: Authentication and user management with JWT tokens
  version: 1.0.0

paths:
  /api/auth/register:
    post:
      tags:
        - Authentication
      summary: Register new user
      description: Create a new user account and return JWT token
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            examples:
              newUser:
                value:
                  name: "John Doe"
                  email: "john@example.com"
                  password: "password123"
                  password_confirmation: "password123"
      responses:
        '201':
          description: Registration successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AuthResponse'
              examples:
                success:
                  value:
                    success: true
                    data:
                      access_token: "eyJ0eXAiOiJKV1QiLCJhbGc..."
                      token_type: "bearer"
                      expires_in: 3600
                      user:
                        id: 1
                        name: "John Doe"
                        email: "john@example.com"
                        username: null
                        phone: null
                        profile_status: "pending"
                        created_at: "2026-01-30T10:00:00Z"
                        updated_at: "2026-01-30T10:00:00Z"
                    message: "Registration successful"
                    code: 201
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/auth/login:
    post:
      tags:
        - Authentication
      summary: Login user
      description: Authenticate user and return JWT token
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            examples:
              credentials:
                value:
                  email: "john@example.com"
                  password: "password123"
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AuthResponse'
              examples:
                success:
                  value:
                    success: true
                    data:
                      access_token: "eyJ0eXAiOiJKV1QiLCJhbGc..."
                      token_type: "bearer"
                      expires_in: 3600
                      user:
                        id: 1
                        name: "John Doe"
                        email: "john@example.com"
                        username: "johndoe"
                        phone: "+1234567890"
                        profile_status: "completed"
                    message: "Login successful"
                    code: 200
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout user
      description: Invalidate current JWT token (blacklist)
      operationId: logout
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              examples:
                success:
                  value:
                    success: true
                    data: null
                    message: "Logged out successfully"
                    code: 200
        '401':
          $ref: '#/components/responses/Unauthenticated'

  /api/auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh JWT token
      description: Get a new JWT token (blacklists old token)
      operationId: refresh
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/TokenResponse'
              examples:
                success:
                  value:
                    success: true
                    data:
                      access_token: "eyJ0eXAiOiJKV1QiLCJhbGc..."
                      token_type: "bearer"
                      expires_in: 3600
                    message: "Token refreshed successfully"
                    code: 200
        '401':
          $ref: '#/components/responses/Unauthenticated'

  /api/auth/me:
    get:
      tags:
        - User Profile
      summary: Get current user
      description: Get authenticated user information
      operationId: me
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/User'
              examples:
                success:
                  value:
                    success: true
                    data:
                      id: 1
                      name: "John Doe"
                      email: "john@example.com"
                      username: "johndoe"
                      phone: "+1234567890"
                      profile_status: "completed"
                      created_at: "2026-01-30T10:00:00Z"
                      updated_at: "2026-01-30T10:00:00Z"
                    message: "OK"
                    code: 200
        '401':
          $ref: '#/components/responses/Unauthenticated'

  /api/auth/profile:
    put:
      tags:
        - User Profile
      summary: Update profile
      description: Update user profile (username, phone, name)
      operationId: updateProfile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileRequest'
            examples:
              completeProfile:
                value:
                  username: "johndoe"
                  phone: "+1234567890"
                  name: "John Doe Updated"
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/StandardResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/User'
              examples:
                success:
                  value:
                    success: true
                    data:
                      id: 1
                      name: "John Doe Updated"
                      email: "john@example.com"
                      username: "johndoe"
                      phone: "+1234567890"
                      profile_status: "completed"
                    message: "Profile updated successfully"
                    code: 200
        '401':
          $ref: '#/components/responses/Unauthenticated'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/auth/forgot-password:
    post:
      tags:
        - Password Management
      summary: Forgot password
      description: Send password reset link to email
      operationId: forgotPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPasswordRequest'
            examples:
              request:
                value:
                  email: "john@example.com"
      responses:
        '200':
          description: Reset link sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              examples:
                success:
                  value:
                    success: true
                    data: null
                    message: "We have emailed your password reset link"
                    code: 200
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/auth/reset-password:
    post:
      tags:
        - Password Management
      summary: Reset password
      description: Reset password with token from email
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
            examples:
              reset:
                value:
                  email: "john@example.com"
                  token: "abc123token"
                  password: "newpassword123"
                  password_confirmation: "newpassword123"
      responses:
        '200':
          description: Password reset successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              examples:
                success:
                  value:
                    success: true
                    data: null
                    message: "Your password has been reset"
                    code: 200
        '400':
          $ref: '#/components/responses/BadRequest'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/auth/change-password:
    post:
      tags:
        - Password Management
      summary: Change password
      description: Change password (requires current password)
      operationId: changePassword
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
            examples:
              change:
                value:
                  current_password: "oldpassword123"
                  password: "newpassword123"
                  password_confirmation: "newpassword123"
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StandardResponse'
              examples:
                success:
                  value:
                    success: true
                    data: null
                    message: "Password changed successfully"
                    code: 200
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthenticated'
        '422':
          $ref: '#/components/responses/ValidationError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token from /api/auth/login or /api/auth/refresh

  schemas:
    # Request Schemas
    RegisterRequest:
      type: object
      required:
        - name
        - email
        - password
        - password_confirmation
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          example: "John Doe"
        email:
          type: string
          format: email
          maxLength: 255
          example: "john@example.com"
        password:
          type: string
          format: password
          minLength: 8
          example: "password123"
        password_confirmation:
          type: string
          format: password
          minLength: 8
          example: "password123"

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "john@example.com"
        password:
          type: string
          format: password
          example: "password123"

    UpdateProfileRequest:
      type: object
      properties:
        username:
          type: string
          maxLength: 255
          example: "johndoe"
          description: Unique username
        phone:
          type: string
          maxLength: 20
          example: "+1234567890"
        name:
          type: string
          maxLength: 255
          example: "John Doe Updated"

    ForgotPasswordRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
          example: "john@example.com"

    ResetPasswordRequest:
      type: object
      required:
        - email
        - token
        - password
        - password_confirmation
      properties:
        email:
          type: string
          format: email
          example: "john@example.com"
        token:
          type: string
          example: "abc123token"
          description: Token from reset email
        password:
          type: string
          format: password
          minLength: 8
          example: "newpassword123"
        password_confirmation:
          type: string
          format: password
          minLength: 8
          example: "newpassword123"

    ChangePasswordRequest:
      type: object
      required:
        - current_password
        - password
        - password_confirmation
      properties:
        current_password:
          type: string
          format: password
          example: "oldpassword123"
        password:
          type: string
          format: password
          minLength: 8
          example: "newpassword123"
        password_confirmation:
          type: string
          format: password
          minLength: 8
          example: "newpassword123"

    # Response Schemas
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "John Doe"
        email:
          type: string
          format: email
          example: "john@example.com"
        username:
          type: string
          nullable: true
          example: "johndoe"
        phone:
          type: string
          nullable: true
          example: "+1234567890"
        profile_status:
          type: string
          enum: [pending, completed]
          example: "completed"
        created_at:
          type: string
          format: date-time
          example: "2026-01-30T10:00:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2026-01-30T10:00:00Z"

    AuthResponse:
      type: object
      properties:
        access_token:
          type: string
          example: "eyJ0eXAiOiJKV1QiLCJhbGc..."
          description: JWT access token
        token_type:
          type: string
          example: "bearer"
        expires_in:
          type: integer
          example: 3600
          description: Token expiration time in seconds
        user:
          $ref: '#/components/schemas/User'

    TokenResponse:
      type: object
      properties:
        access_token:
          type: string
          example: "eyJ0eXAiOiJKV1QiLCJhbGc..."
        token_type:
          type: string
          example: "bearer"
        expires_in:
          type: integer
          example: 3600

    StandardResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          nullable: true
        message:
          type: string
          example: "OK"
        code:
          type: integer
          example: 200

  responses:
    Unauthenticated:
      description: Unauthenticated - Invalid or missing token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/StandardResponse'
          examples:
            error:
              value:
                success: false
                data: null
                message: "Unauthenticated"
                code: 401

    Unauthorized:
      description: Unauthorized - Invalid credentials
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/StandardResponse'
          examples:
            error:
              value:
                success: false
                data: null
                message: "Invalid credentials"
                code: 401

    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/StandardResponse'
              - type: object
                properties:
                  data:
                    type: object
                    properties:
                      errors:
                        type: object
                        additionalProperties:
                          type: array
                          items:
                            type: string
          examples:
            error:
              value:
                success: false
                data:
                  errors:
                    email: ["The email has already been taken."]
                    password: ["The password confirmation does not match."]
                message: "Validation failed"
                code: 422

    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/StandardResponse'
          examples:
            invalidToken:
              value:
                success: false
                data: null
                message: "This password reset token is invalid"
                code: 400
            wrongPassword:
              value:
                success: false
                data: null
                message: "Current password is incorrect"
                code: 400

tags:
  - name: Authentication
    description: User registration, login, logout, and token refresh
  - name: User Profile
    description: View and update user profile
  - name: Password Management
    description: Forgot password, reset password, and change password
